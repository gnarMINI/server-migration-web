<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DCENG ì„œë²„ ì´ì „ ë¦¬ìŠ¤íŠ¸</title>
    <link rel="stylesheet" href="assets/css/bootstrap.min.css">
    <link rel="stylesheet" href="assets/icons/bootstrap-icons.css">
    

    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f8f9fa;
            font-size: 13px;
        }
        .container {
            max-width: 100%;
            width: 100%;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        .header {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 10px;
        }
        .box {
            display: inline-block;      
            width: fit-content;         
            max-width: 100%;            
            border: 2px solid #ccc;
            padding: 15px;
            border-radius: 5px;
            margin: 0 auto 20px auto;
            background: #fff;
        }

        .table-container {
            overflow-x: auto;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            border: 1px solid #ccc;
            padding: 10px;
            text-align: center;
        }
        th {
            background: #ddd;
        }
        .status-progress {
            background-color: yellow;
        }

        .status-complete {
            background-color: gray;
            color: white;
        }
        .small-input {
            width: 70px;
        }
        select option[disabled] {
            color: gray;
        }
        .section-title {
            font-size: 18px;
            font-weight: bold;
            margin-top: 0;  
            margin-bottom: 15px;
            border-bottom: 2px solid #ccc;
            padding-bottom: 5px;
            color: #333;
        }
        .inline-group {
            display: inline-block;
            vertical-align: middle;
            margin-right: 10px;
        }
        .middle-input {
            width: 80px;
        }
        .link-input {
            width: 500px;
        }
        .status-default {
            background-color: white;
            color: black;
        }

        .status-working {
            background-color: green;
            color: white;
        }

        .status-complete {
            background-color: black;
            color: white;
        }
        .status-btn {
            border: none;
            padding: 6px 12px;
            font-weight: bold;
            border-radius: 6px;
            cursor: pointer;
        }

        .status-default {
            background-color: white;
            color: black;
            border: 1px solid #ccc;
        }

        .status-working {
            background-color: green;
            color: white;
        }

        .status-complete {
            background-color: black;
            color: white;
        }
        .urgent-1week {
            background-color: #ffe5e5 !important;
        }
        .urgent-2week {
            background-color: #fff7d9 !important;
        }
        .urgent-3week {
            background-color: #f2fbff !important;
        }
        .completed-row { 
            background-color: #e0e0e0 !important; 
        }
        .pagination-btn {
            margin: 0 3px;
            padding: 4px 8px;
            border: 1px solid #ccc;
            background: #f9f9f9;
            cursor: pointer;
        }
        .pagination-btn.active {
            font-weight: bold;
            background: #ddd;
        }
        #centerFilter button {
            padding: 5px 12px;
            margin-right: 6px;
            border: 1px solid #ccc;
            background: #f4f4f4;
            border-radius: 4px;
            cursor: pointer;
        }
        #centerFilter button:hover {
            background: #ddd;
        }
        .filter-btn {
        padding: 6px 12px;
        border: 1px solid #ccc;
        background: #f0f0f0;
        cursor: pointer;
        border-radius: 5px;
        margin-right: 6px;
        }

        .filter-btn.active {
        background-color: #0d6efd;
        color: white;
        font-weight: bold;
        border-color: #0d6efd;
        }




    </style>
    


      
</head>

<body class="bg-light" style="margin: 0; padding: 0;">
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark w-100" style="margin: 0; border-radius: 0;">
      <div class="container-fluid px-3">
        <a class="navbar-brand" href="#">
          <i class="bi bi-hdd-network me-2"></i> Kakao IDC ì„œë²„ ì´ì „ ë¦¬ìŠ¤íŠ¸ [CBT]
        </a>
      </div>
    </nav>
    
    
    <div class="container-fluid my-4">

        <!-- ì‚¬ìš© ì„¤ëª…ì„œ-->
        <div class="accordion mt-2" id="usageAccordion" style="margin-bottom: 10px;">
            <div class="accordion-item">
              <h2 class="accordion-header" id="usageHeading">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#usageCollapse" aria-expanded="false" aria-controls="usageCollapse">
                  ğŸ›‘ ì‚¬ìš© ì„¤ëª…ì„œ ë³´ê¸°
                </button>
              </h2>
              <div id="usageCollapse" class="accordion-collapse collapse" aria-labelledby="usageHeading" data-bs-parent="#usageAccordion">
                <div class="accordion-body" style="font-size: 15px;">
                    <ul>
                        <li><strong>1. ì‘ì—… ë“±ë¡:</strong> ì´ì „ ì¢…ë¥˜, ì„¼í„°, ì„œë²„ ìˆ˜, ë²¤ë”, ìš”ì²­ì ë“± í•„ìˆ˜ í•­ëª©ì„ ì…ë ¥í•œ ë’¤ <code>SAVE</code> ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ë“±ë¡í•œë‹¤.</li>
                        <li><strong>2. ì´ì „ ìœ í˜• ì„ íƒ:</strong> <code>ì„¼í„° ê°„ ì´ì „</code> ë˜ëŠ” <code>ë‚´ë¶€ ì´ì „</code> ì¤‘ ì„ íƒ ì‹œ, ì…ë ¥ ë°©ì‹ì´ ìë™ ì „í™˜ëœë‹¤.</li>
                        <li><strong>3. ì‘ì—… ì˜µì…˜:</strong> í•­ëª©ì„ ì²´í¬í•˜ë©´ ì§„í–‰ ìƒíƒœë¥¼ ì¶”ì í•  ìˆ˜ ìˆëŠ” ì²´í¬ë°•ìŠ¤ê°€ ìƒì„±ëœë‹¤. ì²´í¬í•˜ì§€ ì•Šìœ¼ë©´ <code>âœ–</code>ë¡œ í‘œì‹œëœë‹¤.</li>
                        <li><strong>4. ë¹„ê³  ì…ë ¥:</strong> ë©”ëª¨ëŠ” ì§ì ‘ ì…ë ¥í•˜ê±°ë‚˜ í‚¤ì›Œë“œ ë²„íŠ¼ì„ í†µí•´ ë¹ ë¥´ê²Œ ì¶”ê°€í•  ìˆ˜ ìˆë‹¤. ì…ë ¥ì°½ì€ ìë™ í™•ì¥ë˜ë©°, ìš°ì¸¡ ë²„íŠ¼ìœ¼ë¡œ í¼ì¹¨/ì ‘ê¸°ë¥¼ ì „í™˜í•  ìˆ˜ ìˆë‹¤.</li>
                        <li><strong>5. ìƒíƒœ ë³€ê²½:</strong> ìƒíƒœ ë²„íŠ¼ í´ë¦­ ì‹œ <code>ìš”ì²­ â†’ ì§„í–‰ â†’ ì™„ë£Œ</code> ìˆœìœ¼ë¡œ ë³€ê²½ëœë‹¤.</li>
                        <li><strong>6. í˜„ì¬ ìœ„ì¹˜ ë³€ê²½:</strong> ì„¼í„° ê°„ ì´ì „ì˜ ê²½ìš° ìœ„ì¹˜ ë²„íŠ¼ í´ë¦­ ì‹œ <code>ì¶œë°œ â†” ë„ì°©</code> ì „í™˜ì´ ê°€ëŠ¥í•˜ë‹¤. ì¶œë°œì§€ëŠ” íŒŒë€ìƒ‰, ë„ì°©ì§€ëŠ” íšŒìƒ‰ìœ¼ë¡œ í‘œì‹œëœë‹¤.</li>
                        <li><strong>7. ì‘ì—… í•„í„°:</strong> ì„¼í„°, ì§„í–‰ ìƒíƒœì— ë”°ë¼ ë‹¤ì–‘í•œ ê¸°ì¤€ìœ¼ë¡œ í•„í„°ë§í•  ìˆ˜ ìˆë‹¤.</li>
                        <li><strong>8. ê²€ìƒ‰ ê¸°ëŠ¥:</strong> ìš”ì²­ì ë˜ëŠ” Agit ë§í¬ ê¸°ì¤€ìœ¼ë¡œ ì‹¤ì‹œê°„ ê²€ìƒ‰ì´ ê°€ëŠ¥í•˜ë‹¤.</li>
                        <li><strong>9. ì§„í–‰ ì‚¬í•­ í•­ëª© ê´€ë¦¬:</strong> ì‘ì—…ì´ ì§„í–‰ë¨ì— ë”°ë¼ Unmount, ì„¼í„° ì´ë™ ì™„ë£Œ, ì‘ì—… íŒŒì¼, ë§ˆìš´íŠ¸, í¬ì„¤ ë“± ì„¸ë¶€ í•­ëª©ì„ ì²´í¬ë°•ìŠ¤ë¡œ ê´€ë¦¬í•œë‹¤. ì´ë¥¼ í†µí•´ ì‘ì—…ì„ ì‹¤ì‹œê°„ìœ¼ë¡œ í™•ì¸ í•  ìˆ˜ ìˆë‹¤.</li>
                        <li><strong>10. ìˆ˜ì • / ì‚­ì œ:</strong> âœï¸ ë˜ëŠ” ğŸ—‘ï¸ ì•„ì´ì½˜ì„ í´ë¦­í•˜ì—¬ ì‘ì—… í•­ëª©ì„ ìˆ˜ì •í•˜ê±°ë‚˜ ì‚­ì œí•  ìˆ˜ ìˆë‹¤.</li>
                        <li><strong>11. ì •ë ¬ ê¸°ëŠ¥:</strong> <code>ìƒíƒœ, ìš”ì²­ì¼, ì™„ë£Œì¼, ë²¤ë”</code>ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì •ë ¬í•  ìˆ˜ ìˆìœ¼ë©°, â­¡ / â­£ ì•„ì´ì½˜ìœ¼ë¡œ ì •ë ¬ ë°©í–¥ì„ í‘œì‹œí•œë‹¤.</li>
                        <li><strong>12. í†µê³„ ìš”ì•½:</strong> í•„í„° ì¡°ê±´ì— ë”°ë¥¸ ì‘ì—… ìˆ˜ì™€ ìƒíƒœë³„ ê±´ìˆ˜ë¥¼ ìƒë‹¨ì— í‘œì‹œí•œë‹¤.</li>
                        <li><strong>13. ì„œë²„ ìˆ˜ í†µê³„:</strong> ì„¼í„°ë³„ ì„œë²„ ìˆ˜ë¥¼ ë§‰ëŒ€ ê·¸ë˜í”„ë¡œ ì‹œê°í™”í•˜ì—¬ ì‘ì—… í˜„í™©ì„ í•œëˆˆì— íŒŒì•…í•  ìˆ˜ ìˆë‹¤.</li>
                        <li><strong>14. Excel ë‹¤ìš´ë¡œë“œ:</strong> í•„í„°ì™€ ê²€ìƒ‰ ì¡°ê±´ì´ ë°˜ì˜ëœ ë°ì´í„°ë§Œ ë‹¤ìš´ë¡œë“œë˜ë©°, ë‹¤ìš´ë¡œë“œ ì „ì— í™•ì¸ ëª¨ë‹¬ì´ í‘œì‹œëœë‹¤.</li>
                        <li><strong>15. ë¹„ê³  ë¯¸ë¦¬ë³´ê¸°:</strong> í…Œì´ë¸” ë‚´ ë¹„ê³  í•­ëª© ìœ„ì— ë§ˆìš°ìŠ¤ë¥¼ ì˜¬ë¦¬ë©´ ì „ì²´ ë©”ëª¨ê°€ íˆ´íŒìœ¼ë¡œ í‘œì‹œëœë‹¤.</li>
                      </ul>
                </div>
              </div>
            </div>
          </div>
        <div> </div>  

        <!-- ì‘ì—… ë“±ë¡ ë°•ìŠ¤ -->
        <div class="row">
            <div class="col-lg-8">
              <div class="card card-form p-3">
              <h5 class="card-title mb-1">ì‘ì—… ë“±ë¡</h5>
              <hr>
              <form>
                <div class="row g-2 mb-3">
                  <div class="col-md-3">
                    <label class="form-label">ì„œë²„ ì´ì „ ì¢…ë¥˜</label>
                    <select id="migrationType" class="form-select form-select-sm" onchange="toggleCenterSelect()">
                      <option value="" disabled selected>ì‘ì—… ì¢…ë¥˜ ì„ íƒ</option>
                      <option value="external">ì„¼í„° ê°„ ì´ì „</option>
                      <option value="internal">ë‚´ë¶€ ì´ì „</option>
                    </select>
                  </div>
                  <div id="centerSelectSection" class="col-md-3 d-none">
                    <label class="form-label">ì„¼í„° ê°„ ì´ì „</label>
                    <div class="input-group input-group-sm">
                      <select id="fromCenter" class="form-select">
                        <option disabled selected>ì¶œë°œ ì„¼í„°</option>
                        <option>AS</option><option>AY</option><option>PG</option><option>MD</option><option>GS</option><option>HN</option>
                      </select>
                      <span class="input-group-text">â†’</span>
                      <select id="toCenter" class="form-select">
                        <option disabled selected>ë„ì°© ì„¼í„°</option>
                        <option>AS</option><option>AY</option><option>PG</option><option>MD</option><option>GS</option><option>HN</option>
                      </select>
                    </div>
                  </div>
                  <div id="internalCenterSection" class="col-md-3 d-none">
                    <label class="form-label">ì‘ì—… ì„¼í„°</label>
                    <select id="internalCenter" class="form-select form-select-sm">
                      <option disabled selected>ì„¼í„° ì„ íƒ</option>
                      <option>AS</option><option>AY</option><option>PG</option><option>MD</option><option>GS</option><option>HN</option>
                    </select>
                  </div>
                </div>
              
                <div class="row g-2 mb-3">
                  <div class="col-md-2 ">
                    <label class="form-label">ë²¤ë”</label>
                    <select id="vendor" class="form-select form-select-sm">
                      <option disabled selected>ë²¤ë” ì„ íƒ</option>
                      <option>KAYTUS</option><option>XFUSION</option><option>DELL</option>
                      <option>HPE</option><option>SUPERMICRO</option><option>ë³µí•©</option><option>ê¸°íƒ€</option>
                    </select>
                  </div>
                  <div class="col-md-2">
                    <label class="form-label">ì„œë²„ ìˆ˜</label>
                    <input id="serverCount" type="number" class="form-control form-control-sm" placeholder="ex) 10">
                  </div>
                  <div class="col-md-2">
                    <label class="form-label">ìš”ì²­ì</label>
                    <div class="input-group input-group-sm">
                      <input id="requester" type="text" class="form-control" placeholder="ì…ë ¥ ë˜ëŠ” ì„ íƒ" style="max-width: 180px;">
                      <button class="btn btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                        ì„ íƒ
                      </button>
                      <ul class="dropdown-menu">
                        <li><a class="dropdown-item" href="#" onclick="setRequester('cliff')">cliff</a></li>
                        <li><a class="dropdown-item" href="#" onclick="setRequester('yum')">yum</a></li>
                        <li><a class="dropdown-item" href="#" onclick="setRequester('luca')">luca</a></li>
                        <li><a class="dropdown-item" href="#" onclick="setRequester('claire')">claire</a></li>
                        <li><a class="dropdown-item" href="#" onclick="setRequester('leo')">leo</a></li>
                        <li><a class="dropdown-item" href="#" onclick="setRequester('kai')">kai</a></li>
                        <li><a class="dropdown-item" href="#" onclick="setRequester('jay')">jay</a></li>
                        <li><a class="dropdown-item" href="#" onclick="setRequester('felix')">felix</a></li>
                        <li><a class="dropdown-item" href="#" onclick="setRequester('cal')">cal</a></li>
                        <li><a class="dropdown-item" href="#" onclick="setRequester('sky')">sky</a></li>
                        <li><a class="dropdown-item" href="#" onclick="setRequester('aive')">aive</a></li>
                        <li><a class="dropdown-item" href="#" onclick="setRequester('lars')">lars</a></li>
                        <li><a class="dropdown-item" href="#" onclick="setRequester('basil')">basil</a></li>
                      </ul>
                    </div>
                  </div>
                  <div class="col-sm-2">
                    <label class="form-label">ì‘ì—… ìš”ì²­ì¼</label>
                    <input id="requestDate" type="date" class="form-control form-control-sm">
                  </div>
                  <div class="col-md-2">
                    <label class="form-label">í¬ë§ ì™„ë£Œì¼</label>
                    <input id="dueDate" type="date" class="form-control form-control-sm">
                  </div>
                    <div class="col-md-5">
                      <label class="form-label">ì‘ì—… ì˜µì…˜</label>
                      <div class="card p-1 bg-light">
                          <div class="d-flex gap-4 align-items-center justify-content-center">
                          <div class="form-check">
                            <input id="partWork" class="form-check-input" type="checkbox">
                            <label class="form-check-label" for="partWork">íŒŒíŠ¸ì‘ì—…</label>
                          </div>
                          <div class="form-check">
                            <input id="osInstall" class="form-check-input" type="checkbox">
                            <label class="form-check-label" for="osInstall">OS ì„¤ì¹˜</label>
                          </div>
                          <div class="form-check">
                            <input id="vendorMigration" class="form-check-input" type="checkbox">
                            <label class="form-check-label" for="vendorMigration">ë²¤ë” ì´ì „</label>
                          </div>
                          <div class="form-check">
                            <input id="serverConfig" class="form-check-input" type="checkbox">
                            <label class="form-check-label" for="serverConfig">ì„œë²„ ì„¤ì •</label>
                          </div>
                        </div>
                      </div>
                    </div>
                </div>
              

                  <div class="row mb-3">
                  <div class="col-md-6">
                    <label class="form-label">ë¹„ê³ </label>
                    <div class="position-relative">
                      <textarea 
                        id="memo" 
                        class="form-control form-control-sm" 
                        rows="1" 
                        placeholder="ë¹„ê³ ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”" 
                        style="resize: vertical; overflow-y: hidden;" 
                        oninput="autoExpand(this)"
                        data-expanded="false"></textarea>
                      <button 
                        type="button" 
                        class="btn btn-sm btn-outline-secondary position-absolute end-0 top-0 mt-1 me-1 py-0 px-1" 
                        onclick="toggleMemoExpand(this)"><i class="bi bi-arrow-down"></i></button>
                    </div>
                  </div>
                    <div class="col-md-6">
                      <label class="form-label">Agit Link</label>
                      <input id="agitLink" type="text" class="form-control form-control-sm" placeholder="ì •í™•íˆ ì…ë ¥í•´ì£¼ì„¸ìš”">
                    </div>
                  </div>

                  <div class="mb-2" style="font-size: 12px;">
                    <label class="form-label" style="font-size: 12px;">ë¹„ê³  í‚¤ì›Œë“œ ì¶”ê°€</label>
                    <div class="d-flex justify-content-between align-items-start mt-1">
                      <div id="memoKeywordButtons" class="d-flex flex-wrap gap-1">
                        <button type="button" class="btn btn-outline-secondary btn-xs py-0 px-1" style="font-size: 11px;" onclick="addMemoTag('25G NIC ì¦ì„¤')">25G NIC ì¦ì„¤</button>
                        <button type="button" class="btn btn-outline-secondary btn-xs py-0 px-1" style="font-size: 11px;" onclick="addMemoTag('10G NIC ì œê±°')">10G NIC ì œê±°</button>
                        <button type="button" class="btn btn-outline-secondary btn-xs py-0 px-1" style="font-size: 11px;" onclick="addMemoTag('ë©”ëª¨ë¦¬ ì¦ì„¤')">ë©”ëª¨ë¦¬ ì¦ì„¤</button>
                        <button type="button" class="btn btn-outline-secondary btn-xs py-0 px-1" style="font-size: 11px;" onclick="addMemoTag('ë©”ëª¨ë¦¬ ì œê±°')">ë©”ëª¨ë¦¬ ì œê±°</button>
                        <button type="button" class="btn btn-outline-secondary btn-xs py-0 px-1" style="font-size: 11px;" onclick="addMemoTag('ë””ìŠ¤í¬ ì¦ì„¤')">ë””ìŠ¤í¬ ì¦ì„¤</button>
                        <button type="button" class="btn btn-outline-secondary btn-xs py-0 px-1" style="font-size: 11px;" onclick="addMemoTag('ë””ìŠ¤í¬ ì œê±°')">ë””ìŠ¤í¬ ì œê±°</button>
                        <button type="button" class="btn btn-outline-secondary btn-xs py-0 px-1" style="font-size: 11px;" onclick="addMemoTag('RAID ì‘ì—…')">RAID ì‘ì—…</button>
                      </div>
                      <div class="d-flex gap-2">
                        <button id="saveTaskButton" type="button" class="btn btn-sm btn-primary" onclick="saveTask()">SAVE</button>
                        <button id="resetBtn" type="button" class="btn btn-sm btn-warning" onclick="resetForm()">ì´ˆê¸°í™”</button>
                        <button id="cancelBtn" type="button" class="btn btn-sm btn-danger" style="display: none;" onclick="cancelEdit()">ì·¨ì†Œ</button>
                      </div>
                    </div>
                  </div>
                <!-- ìˆ¨ê²¨ì§„ ì²´í¬ë°•ìŠ¤ -->
                <input type="checkbox" id="centerMoved" hidden>
                <input type="checkbox" id="workFile" hidden>
                <input type="checkbox" id="mount" hidden>
                <input type="checkbox" id="cabling" hidden>
                <input type="checkbox" id="unmount" hidden>

              </form>
            </div>
          </div>

          <div class="col-lg-4 d-flex align-items-center" style="min-height: 100%;">
            <div class="w-100">
              <div class="card card-summary shadow-sm">
              <div class="card-body">
                <h5 class="card-title mb-2">
                  ğŸ“Š ì‘ì—… í˜„í™© <span class="text-muted" style="font-size: 13px;">(ì„¼í„°ë³„ ì‘ì—…ì´ í•„ìš”í•œ ì„œë²„ ìˆ˜)</span>
                </h5>
                <hr>
                <div id="centerProgressStats" style="font-size: 13px;">
                  <!-- JSë¡œ Progress Bar ì‚½ì… -->
                </div>
                <p class="mt-3 mb-0 text-end text-muted" id="totalServerCount" style="font-size: 12px;"></p>
              </div>
            </div>
              </div>
            </div>
          </div>
        </div>
        <hr>
        </div>
        </div>
        <div class="container-fluid my-4">
        <!-- ì„¼í„° í•„í„° ë²„íŠ¼ -->
        <div class="d-flex justify-content-between align-items-center my-2">
            
            <div class="btn-group" role="group" id="centerFilterGroup">
            <button class="btn btn-sm btn-outline-secondary filter-btn" onclick="setCenterFilter('ALL')">ALL</button>
            <button class="btn btn-sm btn-outline-secondary filter-btn" onclick="setCenterFilter('AS')">AS</button>
            <button class="btn btn-sm btn-outline-secondary filter-btn" onclick="setCenterFilter('AY')">AY</button>
            <button class="btn btn-sm btn-outline-secondary filter-btn" onclick="setCenterFilter('PG')">PG</button>
            <button class="btn btn-sm btn-outline-secondary filter-btn" onclick="setCenterFilter('MD')">MD</button>
            <button class="btn btn-sm btn-outline-secondary filter-btn" onclick="setCenterFilter('GS')">GS</button>
            <button class="btn btn-sm btn-outline-secondary filter-btn" onclick="setCenterFilter('HN')">HN</button>
          </div>
          <div class="d-flex align-items-center gap-2">
            <input 
              type="text" 
              id="searchInput" 
              placeholder="ğŸ” ìš”ì²­ì ë˜ëŠ” Agit ë§í¬ë¡œ ê²€ìƒ‰" 
              oninput="handleSearch()"
              class="form-control form-control-sm"
              style="padding: 6px 10px; width: 250px; border: 1px solid #ccc; border-radius: 4px;"
            >
            <button class="btn btn-sm btn-success" data-bs-toggle="modal" data-bs-target="#excelConfirmModal" onclick="prepareExcelModal()">
              <i class="bi bi-download"></i>&nbsp;Excel
            </button>
          </div>
        </div>
        <div class="d-flex justify-content-between align-items-center my-2">

        <div class="btn-group" role="group" id="statusFilterGroup">
          <button type="button" class="btn btn-sm btn-outline-secondary filter-btn active" onclick="setStatusFilter('ALL')">ì „ì²´ ì‘ì—…</button>
          <button type="button" class="btn btn-sm btn-outline-secondary filter-btn" onclick="setStatusFilter('ìš”ì²­')">ìš”ì²­</button>
        <button type="button" class="btn btn-sm btn-outline-secondary filter-btn" onclick="setStatusFilter('ì§„í–‰')">ì§„í–‰</button>
        <button type="button" class="btn btn-sm btn-outline-secondary filter-btn" onclick="setStatusFilter('ìš”ì²­+ì§„í–‰')">ìš”ì²­+ì§„í–‰</button>
        <button type="button" class="btn btn-sm btn-outline-secondary filter-btn" onclick="setStatusFilter('ì™„ë£Œ')">ì™„ë£Œ</button>
        </div>
        <div id="statusSummary" style="margin: 10px 0; font-weight: bold;"></div>
      </div>
          

        

        <hr>
        <div class="table-responsive mt-4">
            <table class="table table-bordered table-hover table-sm align-middle text-center">
              <thead class="table-light">
                <tr>
                    <th onclick="sortTableBy('status')" style="cursor:pointer;">
                        ì§„í–‰ ìƒíƒœ <i id="sortIcon-status" class="bi ms-1"></i>
                      </th>
                  <th onclick="sortTableBy('requestDate')" style="cursor:pointer;">
                    ì‘ì—… ìš”ì²­ì¼ <i id="sortIcon-requestDate" class="bi ms-1"></i>
                  </th>
                  <th onclick="sortTableBy('dueDate')" style="cursor:pointer;">
                    í¬ë§ ì™„ë£Œì¼ <i id="sortIcon-dueDate" class="bi ms-1"></i>
                  </th>
                  <th>í˜„ì¬ ìœ„ì¹˜</th>
                  <th>ì‘ì—… ì¢…ë¥˜</th>
                  <th>ì‘ì—… ë‚´ìš©</th>
                  <th>ì„œë²„ ìˆ˜</th>
                  <th onclick="sortTableBy('vendor')" style="cursor:pointer;">
                    ë²¤ë” <i id="sortIcon-vendor" class="bi ms-1"></i>
                  </th>
                  <th>ìš”ì²­ì</th>
                  <th>Unmount</th>
                  <th>ì„¼í„° ì´ë™ ì™„ë£Œ</th>
                  <th>ì‘ì—… íŒŒì¼</th>
                  <th>ë§ˆìš´íŠ¸</th>
                  <th>í¬ì„¤</th>
                  <th>íŒŒíŠ¸ ì‘ì—…</th>
                  <th>OS ì„¤ì¹˜</th>
                  <th>ë²¤ë” ì´ì „</th>
                  <th>ì„œë²„ ì„¤ì •</th>
                  <th>ë¹„ê³ </th>
                  <th>Agit Link</th>
                  <th>ìˆ˜ì •</th>
                  <th>ì‚­ì œ</th>
                </tr>
              </thead>
              <tbody>
                <!-- JSë¡œ ë Œë”ë§ëœ í–‰ -->
              </tbody>
            </table>
          </div>
    </div>
    <nav aria-label="í˜ì´ì§€ë„¤ì´ì…˜" class="d-flex justify-content-center mt-4">
        <ul class="pagination pagination-sm" id="pagination"></ul>
      </nav>
      </div>
      
    </div>

    <!-- ëª¨ë‹¬ HTML-->
    <div class="modal fade" id="feedbackModal" tabindex="-1" aria-labelledby="feedbackModalLabel" aria-hidden="true">
        <div class="modal-dialog" style="margin-top: 10vh;">
          <div class="modal-content">
            <div class="modal-header py-2">
              <h5 class="modal-title" id="feedbackModalLabel">ì•Œë¦¼</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="ë‹«ê¸°"></button>
            </div>
            <div class="modal-body" id="feedbackModalBody">
              <!-- ë©”ì‹œì§€ê°€ ì—¬ê¸°ì— ë“¤ì–´ê° -->
            </div>
            <div class="modal-footer py-2">
              <button type="button" class="btn btn-primary btn-sm" data-bs-dismiss="modal">OK</button>
            </div>
          </div>
        </div>
    </div>
    
    <!-- ì‚­ì œ í™•ì¸ ëª¨ë‹¬ -->
    <div class="modal fade" id="confirmDeleteModal" tabindex="-1" aria-labelledby="confirmDeleteLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header bg-danger text-white py-2">
            <h5 class="modal-title" id="confirmDeleteLabel">ì‚­ì œ í™•ì¸</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="ë‹«ê¸°"></button>
            </div>
            <div class="modal-body">
            ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?
            </div>
            <div class="modal-footer py-2">
            <button type="button" class="btn btn-secondary btn-sm" data-bs-dismiss="modal">ì·¨ì†Œ</button>
            <button type="button" class="btn btn-danger btn-sm" id="confirmDeleteBtn">ì‚­ì œ</button>
            </div>
        </div>
        </div>
    </div>
        

    <script>
        ////////////////////////////
        // ì „ì—­ ìƒíƒœ & onload
        ////////////////////////////
        let allTasks = [];
        let currentPage = 1;
        const itemsPerPage = 15;  // í˜ì´ì§€ë‹¹ í‘œì‹œí•  ì‘ì—… ìˆ˜ (ì›í•˜ëŠ” ê°’ìœ¼ë¡œ ì¡°ì ˆ)
        let selectedCenter = "ALL";  // ì„ íƒëœ ì„¼í„° í•„í„° (ê¸°ë³¸ì€ ì „ì²´ ë³´ê¸°)
        let selectedStatus = "ALL";
        let deleteTargetId = null;
        
        let currentSortField = null;
        let sortAscending = true;
        
        function sortTableBy(field) {
            if (currentSortField === field) {
                sortAscending = !sortAscending;
            } else {
                currentSortField = field;
                sortAscending = true;
            }
        
            allTasks.sort((a, b) => {
                const valA = a[field] || '';
                const valB = b[field] || '';
                if (field === 'serverCount') {
                    return sortAscending ? valA - valB : valB - valA;
                }
                return sortAscending
                    ? String(valA).localeCompare(String(valB))
                    : String(valB).localeCompare(String(valA));
            });
        
            currentPage = 1;
            updateDisplayedTasks();
        }

        window.onload = () => {
            setCenterFilter("ALL");    // ì„¼í„° í•„í„° ê¸°ë³¸ê°’
            setStatusFilter("ALL");    // ìƒíƒœ í•„í„° ê¸°ë³¸ê°’
            fetchAndDisplayTasks();    // í˜ì´ì§€ ë¡œë“œ ì‹œ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸°
            // ì˜¤ëŠ˜ ë‚ ì§œ ìë™ ì…ë ¥
            const today = new Date().toISOString().split("T")[0];
            document.getElementById("requestDate").value = today;   
        };


 
        
        ////////////////////////////
        // 1. ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸° + ê²€ìƒ‰
        ////////////////////////////
        function fetchAndDisplayTasks() {
            fetch("/api/tasks")
                .then(res => res.json())
                .then(tasks => {
                    allTasks = tasks;
                    currentPage = 1; // ëª©ë¡ ìƒˆë¡œ ë¶ˆëŸ¬ì˜¬ ë•Œ í˜ì´ì§€ 1ë¡œ
                    updateDisplayedTasks(); // í˜ì´ì§€ë„¤ì´ì…˜ + ê²€ìƒ‰ì–´ ë°˜ì˜
                })
                .catch(err => {
                    console.error("âŒ ì‘ì—… ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨:", err);
                });
        }
        
        // ê²€ìƒ‰ í•¸ë“¤ëŸ¬
        function handleSearch() {
            currentPage = 1;  // ê²€ìƒ‰ ì‹œ í˜ì´ì§€ 1ë¶€í„°
            updateDisplayedTasks();
        }
        
        // ê²€ìƒ‰ + í˜ì´ì§€ë„¤ì´ì…˜ ë°˜ì˜í•˜ì—¬ ìµœì¢… ëª©ë¡ í‘œì‹œ
        function updateDisplayedTasks() {
            const query = document.getElementById("searchInput").value.trim().toLowerCase();
        
            // 1) ê²€ìƒ‰ & í•„í„°
            const filtered = allTasks.filter(task => {
                const requester = task.requester?.toLowerCase() || "";
                const link = task.agitLink?.toLowerCase() || "";
                const matchesSearch = requester.includes(query) || link.includes(query);
                const matchesCenter = selectedCenter === "ALL" || task.currentLocation === selectedCenter;
            const matchesStatus =
                selectedStatus === "ALL" ||
                task.status === selectedStatus ||
                (selectedStatus === "ìš”ì²­+ì§„í–‰" && (task.status === "ìš”ì²­" || task.status === "ì§„í–‰"));
                return matchesSearch && matchesCenter && matchesStatus;
            });

            // 3) í†µê³„ ìš”ì•½ í‘œì‹œ
            renderStatusSummary(filtered);
            renderCenterEmojiStats(allTasks);

            // 4) í˜ì´ì§€ë„¤ì´ì…˜: currentPage, itemsPerPage ê¸°ì¤€
            const start = (currentPage - 1) * itemsPerPage;
            const pageItems = filtered.slice(start, start + itemsPerPage);
        
            // 5) í…Œì´ë¸” ë Œë”
            renderTableRows(pageItems);
        
            // 6) í˜ì´ì§€ë„¤ì´ì…˜ ë²„íŠ¼ ë Œë”
            renderPagination(filtered.length);

           // íˆ´íŒ í™œì„±
            document.querySelectorAll('[data-bs-toggle="tooltip"]').forEach(el => {
            new bootstrap.Tooltip(el);
            });


        }
        
        ////////////////////////////
        // 2. í˜ì´ì§€ë„¤ì´ì…˜
        function renderPagination(totalItems) {
            const totalPages = Math.ceil(totalItems / itemsPerPage);
            const container = document.getElementById("pagination");
            container.innerHTML = "";

            if (totalPages <= 1) return;

            const nav = document.createElement("nav");
            nav.setAttribute("aria-label", "Page navigation");

            const ul = document.createElement("ul");
            ul.className = "pagination justify-content-center";

            const createPageItem = (label, page, disabled = false, active = false) => {
                const li = document.createElement("li");
                li.className = "page-item";
                if (disabled) li.classList.add("disabled");
                if (active) li.classList.add("active");

                const a = document.createElement("a");
                a.className = "page-link";
                a.href = "#";
                a.innerText = label;
                if (!disabled) {
                    a.onclick = (e) => {
                        e.preventDefault();
                        currentPage = page;
                        updateDisplayedTasks();
                    };
                }
                li.appendChild(a);
                return li;
            };

            // Previous
            ul.appendChild(createPageItem("Previous", currentPage - 1, currentPage === 1));

            const range = 2;
            const pageRange = [];
            for (let i = 1; i <= totalPages; i++) {
                if (i === 1 || i === totalPages || (i >= currentPage - range && i <= currentPage + range)) {
                    pageRange.push(i);
                } else if (pageRange[pageRange.length - 1] !== "...") {
                    pageRange.push("...");
                }
            }

            pageRange.forEach(p => {
                if (p === "...") {
                    const li = document.createElement("li");
                    li.className = "page-item disabled";
                    const span = document.createElement("span");
                    span.className = "page-link";
                    span.innerText = "...";
                    li.appendChild(span);
                    ul.appendChild(li);
                } else {
                    ul.appendChild(createPageItem(p, p, false, p === currentPage));
                }
            });

            // Next
            ul.appendChild(createPageItem("Next", currentPage + 1, currentPage === totalPages));

            nav.appendChild(ul);
            container.appendChild(nav);
        }


        
        ////////////////////////////
        // 3. í…Œì´ë¸” ë Œë”ë§ 
        ////////////////////////////
        function renderTableRows(taskArray) {
            const table = document.querySelector("table");
            let tableBody = table.querySelector("tbody");

  

            if (!tableBody) {
                tableBody = document.createElement("tbody");
                table.appendChild(tableBody);
            }
            tableBody.innerHTML = "";

            taskArray.forEach(task => {
                const row = document.createElement("tr");

                // ìƒíƒœ í‘œì‹œìš© í´ë˜ìŠ¤
                const statusLabel = task.status || "ìš”ì²­";
                let statusClass = "btn btn-warning";
                if (statusLabel === "ì§„í–‰") statusClass = "btn-success";
                else if (statusLabel === "ì™„ë£Œ") statusClass = "btn-dark";

                // ë§ˆê°ì¼ì— ë”°ë¼ ìƒ‰ìƒ ì¤„ ì¶”ê°€
                if (statusLabel === "ì™„ë£Œ") {
                    row.classList.add("table-secondary");
                } else if (task.dueDate) {
                    const diffDays = Math.floor((new Date(task.dueDate) - new Date()) / (1000 * 60 * 60 * 24));
                    if (diffDays <= 7) row.classList.add("table-danger");
                    else if (diffDays <= 14) row.classList.add("table-warning");
                    else if (diffDays <= 21) row.classList.add("table-info");
                }

                let locationClass = "btn-secondary"; // í˜„ì¬ìœ„ì¹˜ ë²„íŠ¼ ìƒ‰ìƒ êµ¬í˜„

                if (task.migrationType === "external") {
                    const [from, to] = task.center.split(" â†’ ");
                    locationClass = task.currentLocation === from ? "btn-primary" : "btn-secondary";
                }

                row.innerHTML = `
                    <td>
                        <button 
                            onclick="toggleStatus('${task._id}', '${statusLabel}')"
                            class="btn btn-sm ${statusClass}"
                            title="ìƒíƒœ ë³€ê²½">
                            ${statusLabel}
                        </button>
                    </td>
                    <td>${task.requestDate || "-"}</td>
                    <td>${task.dueDate || "-"}</td>
                    <td>
                        <button 
                            class="btn btn-sm ${locationClass}"
                            onclick="toggleLocation('${task._id}', '${task.currentLocation}', '${task.center}', '${task.migrationType}')"
                            title="ìœ„ì¹˜ ë³€ê²½">
                            ${task.currentLocation}
                        </button>
                    </td>
                    <td>${task.migrationType === "external" ? "ì„¼í„° ê°„ ì´ì „" : "ë‚´ë¶€ ì´ì „"}</td>
                    <td>${task.center}</td>
                    <td>${task.serverCount}</td>
                    <td>${task.vendor}</td>
                    <td>${task.requester}</td>
                    <td>${renderCheckbox(task.unmount, task._id, 'unmount')}</td>
                    <td>${renderCheckbox(task.centerMoved, task._id, 'centerMoved')}</td>
                    <td>${renderCheckbox(task.workFile, task._id, 'workFile')}</td>
                    <td>${renderCheckbox(task.mount, task._id, 'mount')}</td>
                    <td>${renderCheckbox(task.cabling, task._id, 'cabling')}</td>
                    <td>${renderCustomCheckbox(task._id, 'partWork', task.partWork)}</td>
                    <td>${renderCustomCheckbox(task._id, 'reinstallOS', task.reinstallOS)}</td>
                    <td>${task.vendorMigration ? "O" : "âœ–"}</td>
                    <td>${renderCustomCheckbox(task._id, 'serverConfig', task.serverConfig)}</td>
                    <td>
                    <td>
                    ${task.memo
                        ? `<span data-bs-toggle="tooltip" title="${task.memo}" style="cursor: help;">â‰ï¸</span>`
                        : ""}
                    </td>

                    <td>
                        ${task.agitLink 
                            ? `<a href="${task.agitLink}" target="_blank" title="${task.agitLink}">
                                <i class="bi bi-box-arrow-up-right"></i>
                            </a>` 
                            : ""}
                    </td>

                    <td>
                        <button class="btn btn-light btn-sm" onclick="editTask('${task._id}')">âœï¸</button>
                    </td>
                    <td>
                        <button class="btn btn-light btn-sm" onclick="deleteTask('${task._id}')">ğŸ—‘ï¸</button>
                    </td>
                `;
                tableBody.appendChild(row);

                
            });
        }

        function toggleMemo(button) {
            const content = button.nextElementSibling;
            content.classList.toggle("d-none");
        }

        
        ////////////////////////////
        // 4. ì²´í¬ë°•ìŠ¤ (true/false)
        ////////////////////////////
        function renderCheckbox(checked, id, field) {
            return `<input type="checkbox" ${checked ? "checked" : ""} 
                           onclick="toggleCheckbox(this, '${id}', '${field}')"/>`;
        }
        
        function toggleCheckbox(checkbox, id, field) {
            const checked = checkbox.checked;
            fetch(`/api/tasks/${id}`, {
                method: "PATCH",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ [field]: checked })
            })
            .then(res => res.json())
            .then(result => {
                if (!result?.success) {
                    showModal("âŒ ìƒíƒœ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨", "error");
                    checkbox.checked = !checked;
                }
            })
            .catch(err => {
                showModal("âš ï¸ ì„œë²„ ì˜¤ë¥˜", "error");
                checkbox.checked = !checked;
            });
        }
        
        ////////////////////////////
        // 5. ì»¤ìŠ¤í…€ ì²´í¬ë°•ìŠ¤ (âœ– / checked / unchecked)
        ////////////////////////////
        function renderCustomCheckbox(id, field, value) {
            if (value === "âœ–") return "âœ–";
            const isChecked = value === "checked" ? "checked" : "";
            return `<input type="checkbox" ${isChecked} 
                           onclick="toggleCustomCheckbox(this, '${id}', '${field}')"/>`;
        }
        
        function toggleCustomCheckbox(checkbox, id, field) {
            const newValue = checkbox.checked ? "checked" : "unchecked";
            fetch(`/api/tasks/${id}`, {
                method: "PATCH",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ [field]: newValue })
            })
            .then(res => res.json())
            .then(result => {
                if (!result?.success) {
                    showModal("âŒ ìƒíƒœ ë°˜ì˜ ì‹¤íŒ¨", "error");
                    checkbox.checked = !checkbox.checked;
                }
            })
            .catch(err => {
                showModal("âš ï¸ ì„œë²„ ì˜¤ë¥˜", "error");
                checkbox.checked = !checkbox.checked;
            });
        }
        
        ////////////////////////////
        // 6. ìƒíƒœ ë³€ê²½ (ìš”ì²­ â†’ ì§„í–‰ â†’ ì™„ë£Œ)
        ////////////////////////////
        function toggleStatus(id, currentStatus) {
            const nextStatus =
                currentStatus === "ìš”ì²­" ? "ì§„í–‰" :
                currentStatus === "ì§„í–‰" ? "ì™„ë£Œ" : "ìš”ì²­";

            fetch(`/api/tasks/${id}/status`, {
                method: "PUT",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ status: nextStatus })
            })
            .then(async res => {
                const result = await res.json();
                if (res.ok) {
                    const target = allTasks.find(t => t._id === id);
                    if (target) target.status = nextStatus;
                    updateDisplayedTasks();
                } else {
                    showModal("âŒ ìƒíƒœ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨: " + (result.error || "ì„œë²„ ì˜¤ë¥˜"), "error");
                }
            })
            .catch(err => {
                console.error("ìƒíƒœ ë³€ê²½ ì˜¤ë¥˜:", err);
                showModal("âš ï¸ ìƒíƒœ ë³€ê²½ ì¤‘ ì˜¤ë¥˜ ë°œìƒ", "error");
            });
        }

        
        ////////////////////////////
        // 7. ìœ„ì¹˜ í† ê¸€ (fromâ†”to)
        ////////////////////////////
        function toggleLocation(id, currentLocation, center, migrationType) {
            if (migrationType === "internal") return;

            const [from, to] = center.split(" â†’ ");
            const newLocation = currentLocation === from ? to : from;

            fetch(`/api/tasks/${id}/location`, {
                method: "PUT",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ currentLocation: newLocation })
            })
            .then(async res => {
                const result = await res.json();
                if (res.ok) {
                    const target = allTasks.find(t => t._id === id);
                    if (target) target.currentLocation = newLocation;
                    updateDisplayedTasks();
                } else {
                    showModal("âŒ ìœ„ì¹˜ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨: " + (result.error || "ì„œë²„ ì˜¤ë¥˜"), "error");
                }
            })
            .catch(err => {
                console.error("ìœ„ì¹˜ ë³€ê²½ ì˜¤ë¥˜:", err);
                showModal("âš ï¸ ìœ„ì¹˜ ë³€ê²½ ì¤‘ ì˜¤ë¥˜", "error");
            });
        }



        
        ////////////////////////////
        // 8. ë“±ë¡/ìˆ˜ì •/ì‚­ì œ
        ////////////////////////////
        async function saveTask() {
            if (!validateForm()) return;
            const data = collectFormData();
        
            try {
                const res = await fetch("/api/tasks", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(data)
                });
                const result = await res.json();
                if (res.ok) {
                    showModal("âœ… ì €ì¥ ì™„ë£Œ!");
                    resetForm();
                    await fetchAndDisplayTasks(); // ìƒˆ ëª©ë¡ ë°˜ì˜
                    
                } else {
                    showModal("âŒ ì €ì¥ ì‹¤íŒ¨: " + result.error, "error");
                }
            } catch (error) {
                console.error("ì—ëŸ¬ ë°œìƒ:", error);
                showModal("âš ï¸ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜", "warning");
            }
        }
        
        async function updateTask(id) {
            if (!validateForm()) return;

            const existingTask = allTasks.find(t => t._id === id); // ê¸°ì¡´ ê°’ ì°¾ê¸°
            const data = collectFormData(existingTask); // ê¸°ì¡´ê°’ ì „ë‹¬

            try {
                const res = await fetch(`/api/tasks/${id}`, {
                    method: "PUT",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(data)
                });
                await res.json();
                showModal("âœ… ìˆ˜ì • ì™„ë£Œ", "success");
                resetForm();
                await fetchAndDisplayTasks();
                const btn = document.getElementById("saveTaskButton");
                btn.textContent = "SAVE";
                btn.onclick = saveTask;
            } catch (err) {
                console.error(err);
                showModal("âŒ ìˆ˜ì • ì‹¤íŒ¨", "error");
            }
        }


        

        function deleteTask(id) {
                deleteTargetId = id;
                const modal = new bootstrap.Modal(document.getElementById("confirmDeleteModal"));
                modal.show();
            }

            document.getElementById("confirmDeleteBtn").addEventListener("click", async () => {
                if (!deleteTargetId) return;

                try {
                    const res = await fetch(`/api/tasks/${deleteTargetId}`, {
                        method: "DELETE"
                    });
                    const result = await res.json();
                    if (res.ok) {
                        showModal("ğŸ—‘ï¸ ì‚­ì œ ì™„ë£Œ!", "success");
                        await fetchAndDisplayTasks();
                    } else {
                        showModal("âŒ ì‚­ì œ ì‹¤íŒ¨: " + result.error, "error");
                    }
                } catch (err) {
                    console.error("ì‚­ì œ ì˜¤ë¥˜:", err);
                    showModal("âš ï¸ ì„œë²„ ì˜¤ë¥˜ë¡œ ì‚­ì œ ì‹¤íŒ¨", "error");
                }

                const modalEl = document.getElementById("confirmDeleteModal");
                const bsModal = bootstrap.Modal.getInstance(modalEl);
                bsModal.hide();
                deleteTargetId = null;
        });

        
        ////////////////////////////
        // 9. ìˆ˜ì • ëª¨ë“œ (editTask)
        ////////////////////////////
        async function editTask(id) {
            try {
                const res = await fetch(`/api/tasks`);
                const data = await res.json();
                const task = data.find(t => t._id === id);
                if (!task) {
                    showModal("âŒ ì‘ì—…ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.", "error");
                    return;
                }

                document.getElementById("migrationType").value = task.migrationType;
                toggleCenterSelect();

                if (task.migrationType === "external") {
                    const [from, to] = task.center.split(" â†’ ");
                    document.getElementById("fromCenter").value = from;
                    document.getElementById("toCenter").value = to;
                } else {
                    const [c] = task.center.split(" â†’ ");
                    document.getElementById("internalCenter").value = c;
                }

                document.getElementById("vendor").value = task.vendor;
                document.getElementById("serverCount").value = task.serverCount;
                document.getElementById("requester").value = task.requester;
                document.getElementById("dueDate").value = task.dueDate;
                document.getElementById("partWork").checked = task.partWork === "checked";
                document.getElementById("osInstall").checked = task.reinstallOS === "checked";
                document.getElementById("serverConfig").checked = task.serverConfig === "checked";

                document.getElementById("vendorMigration").checked = !!task.vendorMigration;
                document.getElementById("memo").value = task.memo;
                document.getElementById("agitLink").value = task.agitLink;

                // ì¼ë°˜ ì²´í¬ë°•ìŠ¤ í•„ë“œë“¤ ë°˜ì˜
                document.getElementById("centerMoved").checked = task.centerMoved;
                document.getElementById("workFile").checked = task.workFile;
                document.getElementById("mount").checked = task.mount;
                document.getElementById("cabling").checked = task.cabling;
                document.getElementById("unmount").checked = task.unmount;

                // ì €ì¥ ë²„íŠ¼ì„ UPDATE ëª¨ë“œë¡œ ì „í™˜
                const saveBtn = document.getElementById("saveTaskButton");
                saveBtn.textContent = "UPDATE";
                saveBtn.onclick = () => updateTask(id);

                document.getElementById("cancelBtn").style.display = "inline-block";
                document.getElementById("resetBtn").style.display = "none";
            } catch (err) {
                console.error(err);
                showModal("âŒ ìˆ˜ì • ëª¨ë“œ ì§„ì… ì‹¤íŒ¨", "error");
            }
        }

        
        function cancelEdit() {
            resetForm();
            document.getElementById("cancelBtn").style.display = "none";
        }
        
        ////////////////////////////
        // 10. í¼ & ìœ íš¨ì„± ê²€ì‚¬
        ////////////////////////////
        function collectFormData(existingTask = null) {
            const migrationType = document.getElementById("migrationType").value;
            const vendor = document.getElementById("vendor").value;
            const serverCount = document.getElementById("serverCount").value;
            const requester = document.getElementById("requester").value;
            const dueDate = document.getElementById("dueDate").value;
            const memo = document.getElementById("memo").value;
            const agitLink = document.getElementById("agitLink").value;
            const requestDate = document.getElementById("requestDate").value;

            let partWork = "âœ–";
            let reinstallOS = "âœ–";
            let serverConfig = "âœ–";
            const vendorMigration = document.getElementById("vendorMigration").checked;

            if (existingTask) {
                // ê¸°ì¡´ì´ âœ–ì´ë©´ ìœ ì§€
                partWork = existingTask.partWork === "âœ–"
                    ? "âœ–"
                    : (document.getElementById("partWork").checked
                        ? "checked"
                        : "unchecked");
                
                reinstallOS = existingTask.reinstallOS === "âœ–"
                    ? "âœ–"
                    : (document.getElementById("osInstall").checked
                        ? "checked"
                        : "unchecked");

                serverConfig = existingTask.serverConfig === "âœ–"
                    ? "âœ–"
                    : (document.getElementById("serverConfig").checked
                        ? "checked"
                        : "unchecked");
            } else {
                // ìƒˆë¡œ ë“±ë¡í•  ë•Œ
                partWork = document.getElementById("partWork").checked ? "unchecked" : "âœ–";
                reinstallOS = document.getElementById("osInstall").checked ? "unchecked" : "âœ–";
                serverConfig = document.getElementById("serverConfig").checked ? "unchecked" : "âœ–";
            }


            // ì¼ë°˜ ì²´í¬ë°•ìŠ¤ í•„ë“œë“¤ - DOMì—ì„œ ì§ì ‘ ì½ê¸° 
            let centerMoved    = document.getElementById("centerMoved").checked;
            let workFile       = document.getElementById("workFile").checked;
            let mount          = document.getElementById("mount").checked;
            let cabling        = document.getElementById("cabling").checked;
            let unmount        = document.getElementById("unmount").checked;

            // ì„¼í„°ì™€ í˜„ì¬ ìœ„ì¹˜
            let center = "";
            let currentLocation = "";
            if (migrationType === "external") {
                const from = document.getElementById("fromCenter").value;
                const to = document.getElementById("toCenter").value;
                center = `${from} â†’ ${to}`;
                currentLocation = from;
            } else if (migrationType === "internal") {
                const internal = document.getElementById("internalCenter").value;
                center = `${internal} â†’ ${internal}`;
                currentLocation = internal;
            }

            return {
                migrationType, center, currentLocation, vendor, serverCount, requester,
                dueDate, partWork, reinstallOS, memo, agitLink, requestDate,
                centerMoved, workFile, mount, cabling, vendorMigration, serverConfig, unmount
            };
        }



        
        function validateForm() {
            const migrationType = document.getElementById("migrationType");
            const vendor = document.getElementById("vendor");
            const fromCenter = document.getElementById("fromCenter");
            const toCenter = document.getElementById("toCenter");
            const internalCenter = document.getElementById("internalCenter");
            const serverCount = document.getElementById("serverCount");
            const requester = document.getElementById("requester");
            const agitLink = document.getElementById("agitLink");

            // Reset tooltips
            [migrationType, vendor, fromCenter, toCenter, internalCenter, serverCount, requester, agitLink].forEach(el => {
                if (el) {
                    bootstrap.Tooltip.getInstance(el)?.dispose();
                    el.removeAttribute("data-bs-original-title");
                }
            });

            if (!migrationType.value) {
                showTooltip(migrationType, "ì„œë²„ ì´ì „ ì¢…ë¥˜ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.");
                return false;
            }

            if (migrationType.value === "external") {
                if (fromCenter.selectedIndex === 0 || toCenter.selectedIndex === 0) {
                    showTooltip(fromCenter, "ì¶œë°œ, ë„ì°© ì„¼í„°ë¥¼ ëª¨ë‘ ì„ íƒí•´ì£¼ì„¸ìš”.");
                    return false;
                }
            }

            if (migrationType.value === "internal" && internalCenter.selectedIndex === 0) {
                showTooltip(internalCenter, "ì„¼í„°ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.");
                return false;
            }

            if (vendor.selectedIndex === 0) {
                showTooltip(vendor, "ë²¤ë”ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.");
                return false;
            }


            if (!serverCount.value || serverCount.value <= 0) {
                showTooltip(serverCount, "ì„œë²„ ìˆ˜ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
                return false;
            }

            if (!requester.value.trim()) {
                showTooltip(requester, "ìš”ì²­ìë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
                return false;
            }

            if (!agitLink.value.trim()) {
                showTooltip(agitLink, "Agit ë§í¬ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
                return false;
            }

            return true;
        }

        function showTooltip(element, message) {
            // Remove existing tooltip if any
            bootstrap.Tooltip.getInstance(element)?.dispose();
            
            // Set attributes
            element.setAttribute('data-bs-toggle', 'tooltip');
            element.setAttribute('data-bs-placement', 'bottom');
            element.setAttribute('title', message);
            
            // Show tooltip
            const tooltip = new bootstrap.Tooltip(element);
            tooltip.show();
            
            // Auto dismiss after 3 seconds
            setTimeout(() => tooltip.dispose(), 3000);
            
            // Clear tooltip on user input
            element.addEventListener('input', () => {
            bootstrap.Tooltip.getInstance(element)?.dispose();
            }, { once: true });
            
            element.focus();
        }

        
        ////////////////////////////
        // 11. í¼ ì´ˆê¸°í™” + toggle
        ////////////////////////////
        function resetForm() {
            document.getElementById("migrationType").value = "";
            document.getElementById("vendor").value = "";
            document.getElementById("fromCenter").value = "";
            document.getElementById("toCenter").value = "";
            document.getElementById("internalCenter").value = "";
            document.getElementById("serverCount").value = "";
            document.getElementById("requester").value = "";
            document.getElementById("requestDate").value = "";
            document.getElementById("dueDate").value = "";
            document.getElementById("partWork").checked = false;
            document.getElementById("osInstall").checked = false;
            document.getElementById("vendorMigration").checked = false;
            document.getElementById("serverConfig").checked = false;
            document.getElementById("memo").value = "";
            document.getElementById("agitLink").value = "";
            document.getElementById("searchInput").value = "";
        
            toggleCenterSelect();
        
            const saveBtn = document.getElementById("saveTaskButton");
            saveBtn.textContent = "SAVE";
            saveBtn.onclick = saveTask;
        
            document.getElementById("cancelBtn").style.display = "none";
            document.getElementById("resetBtn").style.display = "inline-block";
        }
        
        function toggleCenterSelect() {
            const type = document.getElementById("migrationType").value;
            const centerSection = document.getElementById("centerSelectSection");
            const internalSection = document.getElementById("internalCenterSection");

            if (type === "external") {
                centerSection.classList.remove("d-none");
                internalSection.classList.add("d-none");
            } else if (type === "internal") {
                internalSection.classList.remove("d-none");
                centerSection.classList.add("d-none");
            } else {
                centerSection.classList.add("d-none");
                internalSection.classList.add("d-none");
            }
        }

        
        ////////////////////////////
        // 12. í•„í„°ë§
        ////////////////////////////
        function filterByCenter(center) {
            selectedCenter = center;
            currentPage = 1;
            updateDisplayedTasks();
        }

        function filterByStatus(status) {
            selectedStatus = status;
            currentPage = 1;

            document.querySelectorAll('#statusFilter button').forEach(btn => {
                btn.classList.remove("active-status");
                if (btn.getAttribute("data-status") === status) {
                    btn.classList.add("active-status");
                }
            });

            updateDisplayedTasks();
        }

        function setCenterFilter(center) {
            selectedCenter = center;
            updateDisplayedTasks();
            highlightActiveFilter("center", center);
        }

        function setStatusFilter(status) {
            selectedStatus = status;
            updateDisplayedTasks();
            highlightActiveFilter("status", status);
        }

        function highlightActiveFilter(type, selectedValue) {
            const allBtns = document.querySelectorAll(`.filter-btn`);
            allBtns.forEach(btn => {
                // ì„¼í„° í•„í„°ì¸ì§€ ìƒíƒœ í•„í„°ì¸ì§€ êµ¬ë¶„
                const isCenter = btn.onclick?.toString().includes('setCenterFilter');
                const isStatus = btn.onclick?.toString().includes('setStatusFilter');

                if (
                    (type === "center" && isCenter && btn.getAttribute("onclick")?.includes(`'${selectedValue}'`)) ||
                    (type === "status" && isStatus && btn.getAttribute("onclick")?.includes(`'${selectedValue}'`))
                ) {
                    btn.classList.add("active");
                } else if ((type === "center" && isCenter) || (type === "status" && isStatus)) {
                    btn.classList.remove("active");
                }
            });
        }

        ////////////////////////////
        // 13. í†µê³„
        ////////////////////////////
        function renderStatusSummary(filteredTasks) {
        const total = filteredTasks.length;
        const countByStatus = {
            ìš”ì²­: 0,
            ì§„í–‰: 0,
            ì™„ë£Œ: 0
        };

        filteredTasks.forEach(task => {
          const status = task.status || "ìš”ì²­";
          countByStatus[status] = (countByStatus[status] || 0) + 1;
        });

        const label = selectedCenter === "ALL" ? "ALL" : `${selectedCenter}`;
        const summaryText = `[ ğŸ¢ ${label} ] ì „ì²´ ì‘ì—…: ${total} / ìš”ì²­: ${countByStatus["ìš”ì²­"]} / ì§„í–‰: ${countByStatus["ì§„í–‰"]} / ì™„ë£Œ: ${countByStatus["ì™„ë£Œ"]}`;

            document.getElementById("statusSummary").textContent = summaryText;
        }

        //ì´ëª¨ì§€ í†µê³„
        function renderCenterEmojiStats(filteredTasks) {
            const centerMap = {  AS: 0, AY: 0, PG: 0, MD: 0, GS: 0, HN: 0 };

            filteredTasks.forEach(task => {
                const location = task.currentLocation;
                const count = Number(task.serverCount) || 0;
                if (centerMap.hasOwnProperty(location)) {
                    centerMap[location] += count;
                }
            });

            const container = document.getElementById("centerEmojiStats");
            container.innerHTML = "";

            for (const center in centerMap) {
                const emojiCount = Math.ceil(centerMap[center] / 10);
                const emojis = "ğŸ˜¢".repeat(emojiCount);
                container.innerHTML += `<div><strong>${center}:</strong> ${emojis}</div>`;
            }
        }
       
        function renderCenterEmojiStats(filteredTasks) {
        const centerMap = { AS: 0, AY: 0, PG: 0, MD: 0, GS: 0, HN: 0 };
        let totalServers = 0;

        filteredTasks.forEach(task => {
            const location = task.currentLocation;
            const count = Number(task.serverCount) || 0;
            if (centerMap.hasOwnProperty(location)) {
                centerMap[location] += count;
                totalServers += count;
            }
        });

        const container = document.getElementById("centerProgressStats");
        const totalDisplay = document.getElementById("totalServerCount");
        container.innerHTML = "";

        for (const center in centerMap) {
            const widthPx = centerMap[center] * 4; // 1ëŒ€ë‹¹ 5px ë„ˆë¹„
            container.innerHTML += `
                    <div class="mb-2">
            <div class="d-flex justify-content-between">
                <strong>${center}</strong>
                <small>${centerMap[center]}ëŒ€</small>
            </div>
            <div class="progress" style="height: 24px; background-color: #e9ecef;">
                <div class="progress-bar bg-info text-start ps-2 fw-bold" role="progressbar" style="width: ${widthPx}px">
                    
                    </div>
                </div>
            </div>
            `;
        }

        totalDisplay.textContent = `ì´ ì„œë²„ ìˆ˜: ${totalServers}ëŒ€`;
    }
     

    ////////////////////////////
    // 14. ê¸°íƒ€ í•¨ìˆ˜
    ////////////////////////////

    function addMemoTag(keyword) {
            const memoInput = document.getElementById("memo");
            const currentValue = memoInput.value;
            const tags = currentValue.split(/,\s*/).filter(Boolean);

            if (!tags.includes(keyword)) {
                tags.push(keyword);
                memoInput.value = tags.join(', ');
            }
    }

    function showModal(message, type = 'info') {
        const modalBody = document.getElementById("feedbackModalBody");
        modalBody.innerHTML = message;

        // íƒ€ì…ì— ë”°ë¼ ìƒ‰ìƒ í´ë˜ìŠ¤ ì ìš©
        const header = document.querySelector("#feedbackModal .modal-header");
        header.className = "modal-header py-2";
        if (type === "success") header.classList.add("bg-success", "text-white");
        else if (type === "error") header.classList.add("bg-danger", "text-white");
        else if (type === "warning") header.classList.add("bg-warning", "text-dark");
        else header.classList.add("bg-primary", "text-white");

        const modal = new bootstrap.Modal(document.getElementById("feedbackModal"));
        modal.show();
        }

        
    function setRequester(name) {
        document.getElementById("requester").value = name;
    }

    //ì •ë ¬
    function sortTableBy(field) {
        if (currentSortField === field) {
            sortAscending = !sortAscending;
        } else {
            currentSortField = field;
            sortAscending = true;
        }

        allTasks.sort((a, b) => {
            const valA = a[field] || '';
            const valB = b[field] || '';
            if (field === 'serverCount') {
                return sortAscending ? valA - valB : valB - valA;
            }
            return sortAscending
                ? String(valA).localeCompare(String(valB))
                : String(valB).localeCompare(String(valA));
        });

        // ğŸ”½ ì•„ì´ì½˜ ì—…ë°ì´íŠ¸
        const sortableFields = ["status", "requestDate", "dueDate", "vendor"];
        sortableFields.forEach(f => {
            const icon = document.getElementById(`sortIcon-${f}`);
            if (icon) {
                icon.className = "bi ms-1";
                if (f === field) {
                    icon.classList.add(sortAscending ? "bi-chevron-up" : "bi-chevron-down");
                }
            }
        });

        currentPage = 1;
        updateDisplayedTasks();
    }

    function confirmExcelDownload() {
        const modalEl = document.getElementById("excelConfirmModal");
        const bsModal = bootstrap.Modal.getInstance(modalEl);
        if (bsModal) bsModal.hide();
        const query = document.getElementById("searchInput").value.trim().toLowerCase();
                const filtered = allTasks.filter(task => {
                    const requester = task.requester?.toLowerCase() || "";
                    const link = task.agitLink?.toLowerCase() || "";
                    const matchesSearch = requester.includes(query) || link.includes(query);
                    const matchesCenter = selectedCenter === "ALL" || task.currentLocation === selectedCenter;
                    const matchesStatus =
                        selectedStatus === "ALL" ||
                        task.status === selectedStatus ||
                        (selectedStatus === "ìš”ì²­+ì§„í–‰" && (task.status === "ìš”ì²­" || task.status === "ì§„í–‰"));
                    return matchesSearch && matchesCenter && matchesStatus;
                });

        const rows = filtered.map(task => ({
            ìƒíƒœ: task.status || "ìš”ì²­",
            ìš”ì²­ì¼: task.requestDate || "",
            ì™„ë£Œì¼: task.dueDate || "",
            í˜„ì¬ìœ„ì¹˜: task.currentLocation || "",
            ì´ì „ì¢…ë¥˜: task.migrationType === "external" ? "ì„¼í„° ê°„ ì´ì „" : "ë‚´ë¶€ ì´ì „",
            ì„¼í„°: task.center || "",
            ì„œë²„ìˆ˜: task.serverCount || "",
            ë²¤ë”: task.vendor || "",
            ìš”ì²­ì: task.requester || "",
            ë²¤ë”ì´ì „: task.vendorMigration ? "O" : "âœ–",
            ë¹„ê³ : task.memo || "",
            AgitLink: task.agitLink || ""
        }));

        const worksheet = XLSX.utils.json_to_sheet(rows);
        const workbook = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(workbook, worksheet, "ì‘ì—…ëª©ë¡");
        XLSX.writeFile(workbook, "server_migration_tasks.xlsx");
    }


</script>
<script>
  function prepareExcelModal() {
    const query = document.getElementById("searchInput").value.trim().toLowerCase();
    const filtered = allTasks.filter(task => {
      const requester = task.requester?.toLowerCase() || "";
      const link = task.agitLink?.toLowerCase() || "";
      const matchesSearch = requester.includes(query) || link.includes(query);
      const matchesCenter = selectedCenter === "ALL" || task.currentLocation === selectedCenter;
      const matchesStatus =
        selectedStatus === "ALL" ||
        task.status === selectedStatus ||
        (selectedStatus === "ìš”ì²­+ì§„í–‰" && (task.status === "ìš”ì²­" || task.status === "ì§„í–‰"));
      return matchesSearch && matchesCenter && matchesStatus;
    });

    document.getElementById("filteredCount").textContent = filtered.length;
    document.getElementById("modalCenterFilter").textContent = selectedCenter;
    document.getElementById("modalStatusFilter").textContent = selectedStatus;
    document.getElementById("modalSearchKeyword").textContent = query || "(ì—†ìŒ)";
  }
</script>
<script src="assets/js/bootstrap.bundle.min.js"></script>
<script src="assets/js/xlsx.full.min.js"></script>

<!-- Excel ë‹¤ìš´ë¡œë“œ í™•ì¸ Modal -->
<div class="modal fade" id="excelConfirmModal" tabindex="-1" aria-labelledby="excelConfirmModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header bg-success text-white py-2">
        <h5 class="modal-title" id="excelConfirmModalLabel">Excel ë‹¤ìš´ë¡œë“œ í™•ì¸</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="ë‹«ê¸°"></button>
      </div>
      <div class="modal-body" id="excelConfirmBody" style="font-size: 14px;">
        í•„í„° ì¡°ê±´ì´ ì ìš©ëœ ë°ì´í„° <span class="fw-bold" id="filteredCount"></span>ê±´ì´ ë‹¤ìš´ë¡œë“œë©ë‹ˆë‹¤.<br><br>
        <div><strong>ğŸ“ ì„¼í„°:</strong> <span id="modalCenterFilter"></span></div>
        <div><strong>ğŸ“ ì§„í–‰ ìƒíƒœ:</strong> <span id="modalStatusFilter"></span></div>
        <div><strong>ğŸ“ ê²€ìƒ‰ì–´:</strong> <span id="modalSearchKeyword"></span></div>
      </div>
      <div class="modal-footer py-2">
        <button type="button" class="btn btn-secondary btn-sm" data-bs-dismiss="modal">ì·¨ì†Œ</button>
        <button type="button" class="btn btn-success btn-sm" onclick="confirmExcelDownload()">ë‹¤ìš´ë¡œë“œ</button>
      </div>
    </div>
  </div>
</div>

</body>
</script>
    <script>
      function autoExpand(textarea) {
        textarea.style.height = 'auto';
        textarea.style.height = (textarea.scrollHeight) + 'px';
      }

      function toggleMemoExpand(button) {
        const textarea = button.closest('div').querySelector('textarea');
        const expanded = textarea.getAttribute('data-expanded') === 'true';

        if (expanded) {
            textarea.style.height = 'auto';
            button.innerHTML = '<i class="bi bi-arrow-down"></i>';
            textarea.setAttribute('data-expanded', 'false');
        } else {
            textarea.style.height = (textarea.scrollHeight + 50) + 'px';
            button.innerHTML = '<i class="bi bi-arrow-up"></i>';
            textarea.setAttribute('data-expanded', 'true');
        }
        }
    </script>
</html>

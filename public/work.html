<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì„œë²„ ì´ì „ ë¦¬ìŠ¤íŠ¸</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f4f4f4;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        .header {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 10px;
        }
        .box {
            border: 2px solid #ccc;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            background: #fff;
        }
        .table-container {
            overflow-x: auto;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            border: 1px solid #ccc;
            padding: 10px;
            text-align: center;
        }
        th {
            background: #ddd;
        }
        .status-progress {
            background-color: yellow;
        }
        .status-working {
            background-color: red;
            color: white;
        }
        .status-complete {
            background-color: gray;
            color: white;
        }
        .small-input {
            width: 70px;
        }

        select option[disabled] {
        color: gray;
        }

        .section-title {
        font-size: 18px;
        font-weight: bold;
        margin-top: 0;  
        margin-bottom: 15px;
        border-bottom: 2px solid #ccc;
        padding-bottom: 5px;
        color: #333;
        }

        .inline-group {
        display: inline-block;
        vertical-align: middle;
        margin-right: 10px;
        }

        
        .middle-input {
            width: 80px;
        }

        .link-input {
            width: 500px;
        }


    </style>
</head>
<body>
    <div class="container">
        <div class="header">Kakao IDC team ì„œë²„ ì´ì „ ë¦¬ìŠ¤íŠ¸</div>
        
        <div class="box">
            <p class="section-title">ì‘ì—… ë“±ë¡</p>
            <div class="inline-group">
                <label>ì„œë²„ ì´ì „ ì¢…ë¥˜: </label>  
                <select id="migrationType" onchange="toggleCenterSelect()">
                    <option disabled selected>ì‘ì—… ì¢…ë¥˜ ì„ íƒ</option>
                    <option value="external">ì„¼í„° ê°„ ì´ì „</option>
                    <option value="internal">ë‚´ë¶€ ì´ì „</option>
                </select>
            </div>
            
            <div id="centerSelectSection" class="inline-group" style="display: none;">
                <label>ì„¼í„° ê°„ ì´ì „: </label>
                <select id="fromCenter">
                    <option disabled selected>ì¶œë°œ ì„¼í„°</option>
                    <option>AY</option>
                    <option>AS</option>
                    <option>PG</option>
                    <option>MD</option>
                    <option>GS</option>
                    <option>HN</option>
                </select>
                &nbsp;to&nbsp;
                <select id="toCenter">
                    <option disabled selected>ë„ì°© ì„¼í„°</option>
                    <option>AY</option>
                    <option>AS</option>
                    <option>PG</option>
                    <option>MD</option>
                    <option>GS</option>
                    <option>HN</option>
                </select>
            </div>
            
            <!-- ë‚´ë¶€ ì´ì „ì¼ ê²½ìš° ë³´ì—¬ì§ˆ ì„¼í„° ì„ íƒ -->
            <div id="internalCenterSection" class="inline-group" style="display: none;">
                <label>ì‘ì—… ì„¼í„°: </label>
            <select id="internalCenter">
                    <option disabled selected>ì„¼í„° ì„ íƒ</option>
                    <option>AY</option>
                    <option>AS</option>
                    <option>PG</option>
                    <option>MD</option>
                    <option>GS</option>
                    <option>HN</option>
                </select>
            </div>

            <br><br>
            <label>ë²¤ë”: </label> <select id="vendor">
                <option disabled selected>ë²¤ë” ì„ íƒ</option>
                <option value="kaytus">KAYTUS</option>
                <option value="xfusion">XFUSION</option>
                <option value="others">ê·¸ ì™¸</option>
                <option value="mixed">ë³µí•©</option>
            </select> &nbsp;

            <label>ì„œë²„ ìˆ˜: </label><input id="serverCount" class="small-input" type="number" min="0" placeholder=" Ex)10"> &nbsp;
            <label>ìš”ì²­ì: </label><input id="requester" class="middle-input" type="text" placeholder=" EX) gnar"> &nbsp;
            <br><br>
            <label>í¬ë§ ì™„ë£Œì¼: </label><input id="dueDate" type="date">
            <br><br>
            <label>íŒŒíŠ¸ ì‘ì—…: <input id="partWork" type="checkbox"></label>
            <label>OS ì¬ì„¤ì¹˜: <input id="osInstall" type="checkbox"></label>
            <br><br>
            <label>ë¹„ê³ : </label><textarea id="memo" rows="1" cols="50"></textarea>
            <br><br>
            <label>Agit Link: </label><input id="agitLink" class="link-input" type="text" placeholder="ë§í¬ë¥¼ í†µí•˜ì—¬ ê²€ìƒ‰ë˜ë‹ˆ ì •í™•íˆ ì…ë ¥ë¶€íƒë“œë¦½ë‹ˆë‹¤."> 
            <button onclick="collectFormData()">SAVE</button>
        </div>
        
        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>ì§„í–‰ ìƒíƒœ</th>
                        <th>í¬ë§ ì™„ë£Œì¼</th>
                        <th>í˜„ì¬ ì„œë²„ ìœ„ì¹˜</th>
                        <th>ì‘ì—… ì¢…ë¥˜</th>
                        <th>ì‘ì—… ë‚´ìš©</th>
                        <th>ì„œë²„ ìˆ˜</th>
                        <th>ìš”ì²­ì</th>
                        <th>ì„¼í„° ì´ë™ ì™„ë£Œ</th>
                        <th>ì‘ì—… íŒŒì¼</th>
                        <th>ë§ˆìš´íŠ¸</th>
                        <th>í¬ì„¤</th>
                        <th>íŒŒíŠ¸ ì‘ì—…</th>
                        <th>OS ì„¤ì¹˜</th>
                        <th>ì„œë²„ ì„¤ì •</th>
                        <th>íŒŒíŠ¸ ë°˜ë‚©</th>
                        <th>ë¹„ê³ </th>
                        <th>Agit link</th>
                        <th>ê´€ë¦¬</th>
                        
                    </tr>
                </thead>
                
            </table>
        </div>
    </div>

    <script>
        function toggleCenterSelect() {
            const type = document.getElementById("migrationType").value;
            const externalSection = document.getElementById("centerSelectSection");
            const internalSection = document.getElementById("internalCenterSection");

            if (type === "external") {
                externalSection.style.display = "inline-block";
                internalSection.style.display = "none";
            } else if (type === "internal") {
                internalSection.style.display = "inline-block";
                externalSection.style.display = "none";
            } else {
                externalSection.style.display = "none";
                internalSection.style.display = "none";
            }
        }

    </script>


<script>
    async function collectFormData() {
        const migrationType = document.getElementById("migrationType").value;
        const vendor = document.getElementById("vendor").value;
        const serverCount = document.getElementById("serverCount").value;
        const requester = document.getElementById("requester").value;
        const dueDate = document.getElementById("dueDate").value;
        const partWork = document.getElementById("partWork").checked;
        const reinstallOS = document.getElementById("osInstall").checked;
        const memo = document.getElementById("memo").value;
        const agitLink = document.getElementById("agitLink").value;

        let center = "";

        if (migrationType === "external") {
            const fromCenter = document.getElementById("fromCenter").value;
            const toCenter = document.getElementById("toCenter").value;
            center = `${fromCenter} to ${toCenter}`;
        } else if (migrationType === "internal") {
            const internalCenter = document.getElementById("internalCenter").value;
            center = `${internalCenter} to ${internalCenter}`;
        }

        const data = {
            migrationType,
            center,
            vendor,
            serverCount,
            requester,
            dueDate,
            partWork,
            reinstallOS,
            memo,
            agitLink,
        };

        console.log("ğŸ’¾ ìˆ˜ì§‘ëœ ë°ì´í„°:", data);

        try {
            const response = await fetch("/api/tasks", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify(data)
            });

            const result = await response.json();
            if (response.ok) {
                alert("âœ… ì €ì¥ ì™„ë£Œ!");
                console.log("ğŸ“¦ ì„œë²„ ì‘ë‹µ:", result);
                fetchAndDisplayTasks(); // ì €ì¥ í›„ í…Œì´ë¸” ì¦‰ì‹œ ê°±ì‹ 

            } else {
                alert("âŒ ì €ì¥ ì‹¤íŒ¨: " + result.error);
            }
        } catch (error) {
            console.error("ì—ëŸ¬ ë°œìƒ:", error);
            alert("âš ï¸ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜");
        }
        return data;
}

</script>

<script>
    async function fetchAndDisplayTasks() {
    try {
        const res = await fetch("/api/tasks");
        const tasks = await res.json();

        const table = document.querySelector("table");
        let tableBody = table.querySelector("tbody");

        // tbodyê°€ ì—†ìœ¼ë©´ ìƒì„±í•´ì„œ ë¶™ì´ê¸°
        if (!tableBody) {
            tableBody = document.createElement("tbody");
            table.appendChild(tableBody);
        }

        tableBody.innerHTML = ""; // ê¸°ì¡´ í–‰ ì œê±°

        tasks.forEach(task => {
            const row = document.createElement("tr");
            row.innerHTML = `
                <td>ì§„í–‰ ì „</td>
                <td>${task.dueDate || "-"}</td>
                <td>${task.center}</td>
                <td>${task.migrationType === "external" ? "ì„¼í„° ê°„ ì´ì „" : "ë‚´ë¶€ ì´ì „"}</td>
                <td>-</td>
                <td>${task.serverCount}</td>
                <td>${task.requester}</td>
                <td>-</td>
                <td>-</td>
                <td>-</td>
                <td>-</td>
                <td>${task.partWork ? "âœ…" : ""}</td>
                <td>${task.reinstallOS ? "âœ…" : ""}</td>
                <td>-</td>
                <td>-</td>
                <td>${task.memo || ""}</td>
                <td><a href="${task.agitLink}" target="_blank">${task.agitLink}</a></td>
                <td>
                    <button onclick="editTask('${task._id}')">âœï¸</button>
                    <button onclick="deleteTask('${task._id}')">ğŸ—‘ï¸</button>
                </td>
            `;
            tableBody.appendChild(row);
        });

    } catch (err) {
        console.error("âŒ ì‘ì—… ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨:", err);
    }
}


    // ìˆ˜ì • - ê°„ë‹¨ ì˜ˆ: ì…ë ¥ í¼ì— ê¸°ì¡´ ê°’ ì±„ìš°ê¸°
async function editTask(id) {
    try {
        const res = await fetch(`/api/tasks`);
        const data = await res.json();
        const task = data.find(t => t._id === id);

        if (!task) return alert("ì‘ì—…ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");

        // ì…ë ¥ í¼ì— ê°’ ì±„ì›Œë„£ê¸°
        document.getElementById("migrationType").value = task.migrationType;
        toggleCenterSelect(); // ì„ íƒ ë°•ìŠ¤ ë…¸ì¶œ
        if (task.migrationType === "external") {
            const [from, to] = task.center.split(" to ");
            document.getElementById("fromCenter").value = from;
            document.getElementById("toCenter").value = to;
        } else {
            const [center] = task.center.split(" to ");
            document.getElementById("internalCenter").value = center;
        }

        document.getElementById("vendor").value = task.vendor;
        document.getElementById("serverCount").value = task.serverCount;
        document.getElementById("requester").value = task.requester;
        document.getElementById("dueDate").value = task.dueDate;
        document.getElementById("partWork").checked = task.partWork;
        document.getElementById("osInstall").checked = task.reinstallOS;
        document.getElementById("memo").value = task.memo;
        document.getElementById("agitLink").value = task.agitLink;

        // ì €ì¥ ë²„íŠ¼ì„ ìˆ˜ì • ëª¨ë“œë¡œ ë³€ê²½
        const saveBtn = document.querySelector("button[onclick='collectFormData()']");
        saveBtn.textContent = "UPDATE";
        saveBtn.onclick = () => updateTask(id);

    } catch (err) {
        console.error(err);
        alert("âŒ ìˆ˜ì • ëª¨ë“œ ì§„ì… ì‹¤íŒ¨");
    }
}

async function updateTask(id) {
    const data = collectFormData(); // ê¸°ì¡´ collectFormData ë‚´ìš©ì„ í•¨ìˆ˜ë¡œ ë¶„ë¦¬í–ˆë‹¤ë©´!

    try {
        const res = await fetch(`/api/tasks/${id}`, {
            method: "PUT",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify(data)
        });
        const result = await res.json();
        alert("âœ… ìˆ˜ì • ì™„ë£Œ");
        fetchAndDisplayTasks();

        // ì €ì¥ ë²„íŠ¼ ì›ìƒë³µêµ¬
        const saveBtn = document.querySelector("button[onclick]");
        saveBtn.textContent = "SAVE";
        saveBtn.onclick = collectFormData;

    } catch (err) {
        console.error(err);
        alert("âŒ ìˆ˜ì • ì‹¤íŒ¨");
    }
}


    // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ ì‹¤í–‰
    window.onload = fetchAndDisplayTasks;
    </script>
    

    
        
</body>
</html>
